#!/usr/bin/env python3\n\"\"\"\nç®€åŒ–çš„ BMAD Agent FastMCP Service æµ‹è¯•\n\nç›´æ¥æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½ï¼Œä¸ä¾èµ– FastMCP çš„å†…éƒ¨ API\n\"\"\"\n\nimport sys\nfrom pathlib import Path\n\ndef test_bmad_core():\n    \"\"\"æµ‹è¯• BMAD æ ¸å¿ƒåŠŸèƒ½\"\"\"\n    print(\"ğŸ§ª æµ‹è¯• BMAD æ ¸å¿ƒåŠŸèƒ½\")\n    print(\"-\" * 30)\n    \n    try:\n        from bmad_agent_mcp import bmad_core\n        \n        print(f\"âœ… BMAD æ ¸å¿ƒåŠ è½½æˆåŠŸ\")\n        print(f\"   æ™ºèƒ½ä½“æ•°é‡: {len(bmad_core.agents)}\")\n        print(f\"   å·¥ä½œæµç¨‹æ•°é‡: {len(bmad_core.workflows)}\")\n        print(f\"   ä»»åŠ¡æ•°é‡: {len(bmad_core.tasks)}\")\n        print(f\"   æ¨¡æ¿æ•°é‡: {len(bmad_core.templates)}\")\n        \n        # åˆ—å‡ºæ™ºèƒ½ä½“\n        if bmad_core.agents:\n            print(f\"\\nğŸ¤– å‘ç°çš„æ™ºèƒ½ä½“:\")\n            for agent_id, agent in list(bmad_core.agents.items())[:5]:\n                print(f\"   - {agent_id}: {agent.title} {agent.icon}\")\n            if len(bmad_core.agents) > 5:\n                print(f\"   ... è¿˜æœ‰ {len(bmad_core.agents) - 5} ä¸ªæ™ºèƒ½ä½“\")\n        \n        # åˆ—å‡ºå·¥ä½œæµç¨‹\n        if bmad_core.workflows:\n            print(f\"\\nğŸ“‹ å‘ç°çš„å·¥ä½œæµç¨‹:\")\n            for workflow_id, workflow in list(bmad_core.workflows.items())[:3]:\n                print(f\"   - {workflow_id}: {workflow.name}\")\n            if len(bmad_core.workflows) > 3:\n                print(f\"   ... è¿˜æœ‰ {len(bmad_core.workflows) - 3} ä¸ªå·¥ä½œæµç¨‹\")\n        \n        return True\n        \n    except Exception as e:\n        print(f\"âŒ BMAD æ ¸å¿ƒåŠ è½½å¤±è´¥: {e}\")\n        return False\n\ndef test_llm_client():\n    \"\"\"æµ‹è¯• LLM å®¢æˆ·ç«¯\"\"\"\n    print(\"\\nğŸ§ª æµ‹è¯• LLM å®¢æˆ·ç«¯\")\n    print(\"-\" * 30)\n    \n    try:\n        from llm_client import LLMClient\n        \n        client = LLMClient()\n        print(f\"âœ… LLM å®¢æˆ·ç«¯åˆ›å»ºæˆåŠŸ\")\n        \n        # è·å–æ¨¡å¼ä¿¡æ¯\n        mode_info = client.get_mode_info()\n        print(f\"   å½“å‰æ¨¡å¼: {mode_info['mode']}\")\n        print(f\"   çŠ¶æ€: {mode_info['status']}\")\n        \n        # æµ‹è¯•æ¨¡å¼åˆ‡æ¢\n        print(f\"\\nğŸ”„ æµ‹è¯•æ¨¡å¼åˆ‡æ¢:\")\n        \n        # åˆ‡æ¢åˆ°å†…ç½®æ¨¡å¼\n        result = client.switch_mode('builtin')\n        print(f\"   åˆ‡æ¢åˆ°å†…ç½®æ¨¡å¼: {result['success']}\")\n        \n        # åˆ‡æ¢åˆ°å¤–éƒ¨æ¨¡å¼ï¼ˆå¦‚æœæœ‰ API Keyï¼‰\n        result = client.switch_mode('external')\n        if result['success']:\n            print(f\"   åˆ‡æ¢åˆ°å¤–éƒ¨æ¨¡å¼: {result['success']}\")\n        else:\n            print(f\"   å¤–éƒ¨æ¨¡å¼ä¸å¯ç”¨: {result.get('error', 'æœªçŸ¥é”™è¯¯')}\")\n        \n        # åˆ‡æ¢å›å†…ç½®æ¨¡å¼\n        client.switch_mode('builtin')\n        print(f\"   åˆ‡æ¢å›å†…ç½®æ¨¡å¼: âœ…\")\n        \n        return True\n        \n    except Exception as e:\n        print(f\"âŒ LLM å®¢æˆ·ç«¯æµ‹è¯•å¤±è´¥: {e}\")\n        return False\n\ndef test_utils():\n    \"\"\"æµ‹è¯•å·¥å…·å‡½æ•°\"\"\"\n    print(\"\\nğŸ§ª æµ‹è¯•å·¥å…·å‡½æ•°\")\n    print(\"-\" * 30)\n    \n    try:\n        from utils import (\n            validate_bmad_core_structure,\n            get_agent_info,\n            get_workflow_info,\n            format_agent_response\n        )\n        \n        print(f\"âœ… å·¥å…·å‡½æ•°å¯¼å…¥æˆåŠŸ\")\n        \n        # éªŒè¯ BMAD æ ¸å¿ƒç»“æ„\n        validation_result = validate_bmad_core_structure()\n        print(f\"   BMAD ç»“æ„éªŒè¯: {'âœ…' if validation_result['valid'] else 'âŒ'}\")\n        \n        if not validation_result['valid']:\n            print(f\"   éªŒè¯é”™è¯¯: {validation_result.get('errors', [])}\")\n        else:\n            print(f\"   å‘ç°ç»„ä»¶: {validation_result.get('components', {})}\")\n        \n        return validation_result['valid']\n        \n    except Exception as e:\n        print(f\"âŒ å·¥å…·å‡½æ•°æµ‹è¯•å¤±è´¥: {e}\")\n        return False\n\ndef test_file_structure():\n    \"\"\"æµ‹è¯•æ–‡ä»¶ç»“æ„\"\"\"\n    print(\"\\nğŸ§ª æµ‹è¯•æ–‡ä»¶ç»“æ„\")\n    print(\"-\" * 30)\n    \n    required_files = [\n        'bmad_agent_mcp.py',\n        'llm_client.py',\n        'utils.py',\n        'requirements.txt',\n        '.bmad-core/core-config.yaml'\n    ]\n    \n    required_dirs = [\n        '.bmad-core',\n        '.bmad-core/agents',\n        '.bmad-core/workflows',\n        '.bmad-core/templates',\n        '.bmad-core/tasks'\n    ]\n    \n    all_good = True\n    \n    # æ£€æŸ¥å¿…éœ€æ–‡ä»¶\n    print(\"ğŸ“„ æ£€æŸ¥å¿…éœ€æ–‡ä»¶:\")\n    for file_path in required_files:\n        if Path(file_path).exists():\n            print(f\"   âœ… {file_path}\")\n        else:\n            print(f\"   âŒ {file_path} (ç¼ºå¤±)\")\n            all_good = False\n    \n    # æ£€æŸ¥å¿…éœ€ç›®å½•\n    print(\"\\nğŸ“ æ£€æŸ¥å¿…éœ€ç›®å½•:\")\n    for dir_path in required_dirs:\n        if Path(dir_path).exists():\n            print(f\"   âœ… {dir_path}\")\n        else:\n            print(f\"   âŒ {dir_path} (ç¼ºå¤±)\")\n            all_good = False\n    \n    # æ£€æŸ¥æ™ºèƒ½ä½“æ–‡ä»¶\n    agents_dir = Path('.bmad-core/agents')\n    if agents_dir.exists():\n        agent_files = list(agents_dir.glob('*.md'))\n        print(f\"\\nğŸ¤– æ™ºèƒ½ä½“æ–‡ä»¶: {len(agent_files)} ä¸ª\")\n        for agent_file in agent_files[:5]:\n            print(f\"   - {agent_file.name}\")\n        if len(agent_files) > 5:\n            print(f\"   ... è¿˜æœ‰ {len(agent_files) - 5} ä¸ª\")\n    \n    # æ£€æŸ¥å·¥ä½œæµç¨‹æ–‡ä»¶\n    workflows_dir = Path('.bmad-core/workflows')\n    if workflows_dir.exists():\n        workflow_files = list(workflows_dir.glob('*.yaml'))\n        print(f\"\\nğŸ“‹ å·¥ä½œæµç¨‹æ–‡ä»¶: {len(workflow_files)} ä¸ª\")\n        for workflow_file in workflow_files:\n            print(f\"   - {workflow_file.name}\")\n    \n    return all_good\n\ndef test_imports():\n    \"\"\"æµ‹è¯•æ¨¡å—å¯¼å…¥\"\"\"\n    print(\"\\nğŸ§ª æµ‹è¯•æ¨¡å—å¯¼å…¥\")\n    print(\"-\" * 30)\n    \n    modules_to_test = [\n        ('fastmcp', 'FastMCP æ¡†æ¶'),\n        ('yaml', 'YAML è§£æ'),\n        ('pathlib', 'Path æ“ä½œ'),\n        ('json', 'JSON å¤„ç†'),\n        ('os', 'æ“ä½œç³»ç»Ÿæ¥å£'),\n        ('sys', 'ç³»ç»Ÿæ¥å£'),\n        ('logging', 'æ—¥å¿—è®°å½•')\n    ]\n    \n    all_good = True\n    \n    for module_name, description in modules_to_test:\n        try:\n            __import__(module_name)\n            print(f\"   âœ… {module_name} ({description})\")\n        except ImportError as e:\n            print(f\"   âŒ {module_name} ({description}) - {e}\")\n            all_good = False\n    \n    return all_good\n\ndef main():\n    \"\"\"ä¸»æµ‹è¯•å‡½æ•°\"\"\"\n    print(\"ğŸš€ BMAD Agent FastMCP Service æµ‹è¯•\")\n    print(\"=\" * 50)\n    \n    tests = [\n        (\"æ–‡ä»¶ç»“æ„\", test_file_structure),\n        (\"æ¨¡å—å¯¼å…¥\", test_imports),\n        (\"å·¥å…·å‡½æ•°\", test_utils),\n        (\"LLM å®¢æˆ·ç«¯\", test_llm_client),\n        (\"BMAD æ ¸å¿ƒ\", test_bmad_core)\n    ]\n    \n    results = []\n    \n    for test_name, test_func in tests:\n        try:\n            result = test_func()\n            results.append((test_name, result))\n        except Exception as e:\n            print(f\"\\nâŒ æµ‹è¯• '{test_name}' å‡ºç°å¼‚å¸¸: {e}\")\n            results.append((test_name, False))\n    \n    # æ€»ç»“\n    print(\"\\n\" + \"=\" * 50)\n    print(\"ğŸ“Š æµ‹è¯•ç»“æœæ€»ç»“\")\n    print(\"-\" * 30)\n    \n    passed = 0\n    total = len(results)\n    \n    for test_name, result in results:\n        status = \"âœ… é€šè¿‡\" if result else \"âŒ å¤±è´¥\"\n        print(f\"   {test_name}: {status}\")\n        if result:\n            passed += 1\n    \n    print(f\"\\nğŸ¯ æ€»ä½“ç»“æœ: {passed}/{total} æµ‹è¯•é€šè¿‡\")\n    \n    if passed == total:\n        print(\"ğŸ‰ æ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡äº†ï¼BMAD Agent æœåŠ¡å·²å‡†å¤‡å°±ç»ªã€‚\")\n        return 0\n    else:\n        print(\"âš ï¸  éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®å’Œä¾èµ–ã€‚\")\n        return 1\n\nif __name__ == \"__main__\":\n    sys.exit(main())"