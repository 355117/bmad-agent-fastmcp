#!/usr/bin/env python3\n\"\"\"\nBMAD Agent ç®€åŒ–æµ‹è¯•ç‰ˆæœ¬\n\"\"\"\n\nimport os\nimport json\nfrom typing import Dict, Any, Optional\nfrom fastmcp import FastMCP\n\n# åˆå§‹åŒ– FastMCP åº”ç”¨\nmcp = FastMCP(\"BMAD Agent Test Service\")\n\n# LLM é…ç½®\nUSE_BUILTIN_LLM = os.getenv(\"USE_BUILTIN_LLM\", \"true\").lower() == \"true\"\n\n@mcp.tool()\ndef test_connection() -> Dict[str, Any]:\n    \"\"\"\n    æµ‹è¯• BMAD æœåŠ¡è¿æ¥\n    \n    Returns:\n        Dict[str, Any]: è¿æ¥çŠ¶æ€ä¿¡æ¯\n    \"\"\"\n    return {\n        \"success\": True,\n        \"service\": \"BMAD Agent Test Service\",\n        \"mode\": \"builtin_llm\" if USE_BUILTIN_LLM else \"external_api\",\n        \"status\": \"connected\",\n        \"message\": \"ğŸ‰ BMAD æœåŠ¡è¿æ¥æˆåŠŸï¼\"\n    }\n\n@mcp.tool()\ndef test_agents() -> Dict[str, Any]:\n    \"\"\"\n    æµ‹è¯•æ™ºèƒ½ä½“åŠŸèƒ½\n    \n    Returns:\n        Dict[str, Any]: æ™ºèƒ½ä½“æµ‹è¯•ç»“æœ\n    \"\"\"\n    test_agents = [\n        {\"id\": \"pm\", \"title\": \"äº§å“ç»ç†\", \"icon\": \"ğŸ‘”\"},\n        {\"id\": \"dev\", \"title\": \"å…¨æ ˆå¼€å‘è€…\", \"icon\": \"ğŸ’»\"},\n        {\"id\": \"analyst\", \"title\": \"ä¸šåŠ¡åˆ†æå¸ˆ\", \"icon\": \"ğŸ“Š\"}\n    ]\n    \n    return {\n        \"success\": True,\n        \"agents_count\": len(test_agents),\n        \"agents\": test_agents,\n        \"message\": \"âœ… æ™ºèƒ½ä½“æµ‹è¯•é€šè¿‡\"\n    }\n\n@mcp.tool()\ndef test_llm_mode() -> Dict[str, Any]:\n    \"\"\"\n    æµ‹è¯• LLM æ¨¡å¼\n    \n    Returns:\n        Dict[str, Any]: LLM æ¨¡å¼æµ‹è¯•ç»“æœ\n    \"\"\"\n    current_mode = \"builtin_llm\" if USE_BUILTIN_LLM else \"external_api\"\n    \n    return {\n        \"success\": True,\n        \"current_mode\": current_mode,\n        \"builtin_available\": True,\n        \"external_available\": bool(os.getenv(\"DEEPSEEK_API_KEY\")),\n        \"message\": f\"âœ… å½“å‰ä½¿ç”¨ {current_mode} æ¨¡å¼\"\n    }\n\n@mcp.tool()\ndef test_workflows() -> Dict[str, Any]:\n    \"\"\"\n    æµ‹è¯•å·¥ä½œæµç¨‹åŠŸèƒ½\n    \n    Returns:\n        Dict[str, Any]: å·¥ä½œæµç¨‹æµ‹è¯•ç»“æœ\n    \"\"\"\n    test_workflows = [\n        {\"id\": \"greenfield-fullstack\", \"name\": \"å…¨æ ˆå¼€å‘ï¼ˆæ–°é¡¹ç›®ï¼‰\"},\n        {\"id\": \"brownfield-fullstack\", \"name\": \"å…¨æ ˆå¼€å‘ï¼ˆç°æœ‰é¡¹ç›®ï¼‰\"},\n        {\"id\": \"greenfield-service\", \"name\": \"æœåŠ¡å¼€å‘ï¼ˆæ–°é¡¹ç›®ï¼‰\"}\n    ]\n    \n    return {\n        \"success\": True,\n        \"workflows_count\": len(test_workflows),\n        \"workflows\": test_workflows,\n        \"message\": \"âœ… å·¥ä½œæµç¨‹æµ‹è¯•é€šè¿‡\"\n    }\n\n@mcp.tool()\ndef test_templates() -> Dict[str, Any]:\n    \"\"\"\n    æµ‹è¯•æ¨¡æ¿åŠŸèƒ½\n    \n    Returns:\n        Dict[str, Any]: æ¨¡æ¿æµ‹è¯•ç»“æœ\n    \"\"\"\n    test_templates = [\n        {\"name\": \"prd-template\", \"description\": \"äº§å“éœ€æ±‚æ–‡æ¡£æ¨¡æ¿\"},\n        {\"name\": \"architecture-template\", \"description\": \"ç³»ç»Ÿæ¶æ„æ–‡æ¡£æ¨¡æ¿\"},\n        {\"name\": \"story-template\", \"description\": \"ç”¨æˆ·æ•…äº‹æ¨¡æ¿\"}\n    ]\n    \n    return {\n        \"success\": True,\n        \"templates_count\": len(test_templates),\n        \"templates\": test_templates,\n        \"message\": \"âœ… æ¨¡æ¿æµ‹è¯•é€šè¿‡\"\n    }\n\n@mcp.tool()\ndef run_full_test() -> Dict[str, Any]:\n    \"\"\"\n    è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶\n    \n    Returns:\n        Dict[str, Any]: å®Œæ•´æµ‹è¯•ç»“æœ\n    \"\"\"\n    test_results = []\n    \n    # æµ‹è¯•è¿æ¥\n    try:\n        connection_result = test_connection()\n        test_results.append({\"test\": \"connection\", \"status\": \"âœ… é€šè¿‡\", \"details\": connection_result})\n    except Exception as e:\n        test_results.append({\"test\": \"connection\", \"status\": \"âŒ å¤±è´¥\", \"error\": str(e)})\n    \n    # æµ‹è¯•æ™ºèƒ½ä½“\n    try:\n        agents_result = test_agents()\n        test_results.append({\"test\": \"agents\", \"status\": \"âœ… é€šè¿‡\", \"details\": agents_result})\n    except Exception as e:\n        test_results.append({\"test\": \"agents\", \"status\": \"âŒ å¤±è´¥\", \"error\": str(e)})\n    \n    # æµ‹è¯• LLM æ¨¡å¼\n    try:\n        llm_result = test_llm_mode()\n        test_results.append({\"test\": \"llm_mode\", \"status\": \"âœ… é€šè¿‡\", \"details\": llm_result})\n    except Exception as e:\n        test_results.append({\"test\": \"llm_mode\", \"status\": \"âŒ å¤±è´¥\", \"error\": str(e)})\n    \n    # æµ‹è¯•å·¥ä½œæµç¨‹\n    try:\n        workflows_result = test_workflows()\n        test_results.append({\"test\": \"workflows\", \"status\": \"âœ… é€šè¿‡\", \"details\": workflows_result})\n    except Exception as e:\n        test_results.append({\"test\": \"workflows\", \"status\": \"âŒ å¤±è´¥\", \"error\": str(e)})\n    \n    # æµ‹è¯•æ¨¡æ¿\n    try:\n        templates_result = test_templates()\n        test_results.append({\"test\": \"templates\", \"status\": \"âœ… é€šè¿‡\", \"details\": templates_result})\n    except Exception as e:\n        test_results.append({\"test\": \"templates\", \"status\": \"âŒ å¤±è´¥\", \"error\": str(e)})\n    \n    # ç»Ÿè®¡ç»“æœ\n    passed_tests = sum(1 for result in test_results if \"âœ…\" in result[\"status\"])\n    total_tests = len(test_results)\n    \n    return {\n        \"success\": passed_tests == total_tests,\n        \"summary\": f\"{passed_tests}/{total_tests} æµ‹è¯•é€šè¿‡\",\n        \"test_results\": test_results,\n        \"message\": \"ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼\" if passed_tests == total_tests else \"âš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥\"\n    }\n\n@mcp.tool()\ndef get_system_info() -> Dict[str, Any]:\n    \"\"\"\n    è·å–ç³»ç»Ÿä¿¡æ¯\n    \n    Returns:\n        Dict[str, Any]: ç³»ç»Ÿä¿¡æ¯\n    \"\"\"\n    return {\n        \"service_name\": \"BMAD Agent Test Service\",\n        \"version\": \"1.0.0\",\n        \"python_version\": f\"{os.sys.version_info.major}.{os.sys.version_info.minor}.{os.sys.version_info.micro}\",\n        \"environment\": {\n            \"USE_BUILTIN_LLM\": os.getenv(\"USE_BUILTIN_LLM\", \"true\"),\n            \"DEEPSEEK_API_KEY\": \"å·²é…ç½®\" if os.getenv(\"DEEPSEEK_API_KEY\") else \"æœªé…ç½®\",\n            \"PYTHONPATH\": os.getenv(\"PYTHONPATH\", \"æœªè®¾ç½®\")\n        },\n        \"features\": [\n            \"æ™ºèƒ½ä½“ç®¡ç†\",\n            \"å·¥ä½œæµç¨‹æ§åˆ¶\",\n            \"åŒ LLM æ¨¡å¼\",\n            \"æ¨¡æ¿ç³»ç»Ÿ\",\n            \"MCP åè®®æ”¯æŒ\"\n        ],\n        \"status\": \"è¿è¡Œä¸­\",\n        \"message\": \"ğŸ“Š ç³»ç»Ÿä¿¡æ¯è·å–æˆåŠŸ\"\n    }\n\n# ä¸»å‡½æ•°\nif __name__ == \"__main__\":\n    print(\"ğŸš€ å¯åŠ¨ BMAD Agent æµ‹è¯•æœåŠ¡...\")\n    print(f\"ğŸ“ å½“å‰ LLM æ¨¡å¼: {'å†…ç½®æ¨¡å¼' if USE_BUILTIN_LLM else 'å¤–éƒ¨ API æ¨¡å¼'}\")\n    print(\"ğŸ”§ å¯ç”¨æµ‹è¯•å·¥å…·:\")\n    print(\"   - test_connection(): æµ‹è¯•æœåŠ¡è¿æ¥\")\n    print(\"   - test_agents(): æµ‹è¯•æ™ºèƒ½ä½“åŠŸèƒ½\")\n    print(\"   - test_llm_mode(): æµ‹è¯• LLM æ¨¡å¼\")\n    print(\"   - test_workflows(): æµ‹è¯•å·¥ä½œæµç¨‹\")\n    print(\"   - test_templates(): æµ‹è¯•æ¨¡æ¿åŠŸèƒ½\")\n    print(\"   - run_full_test(): è¿è¡Œå®Œæ•´æµ‹è¯•\")\n    print(\"   - get_system_info(): è·å–ç³»ç»Ÿä¿¡æ¯\")\n    print(\"\\nâœ… æµ‹è¯•æœåŠ¡å·²å‡†å¤‡å°±ç»ªï¼\")\n    \n    # å¯åŠ¨ FastMCP æœåŠ¡\n    mcp.run()"